<!doctype html><html lang=zh dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>智能驾驶 | Mens et Manus</title>
<meta name=keywords content>
<meta name=description content="绵绵春雨懒洋洋，故友不来不起床。">
<meta name=author content="Me">
<link rel=canonical href=https://loganchow.github.io/categories/%E6%99%BA%E8%83%BD%E9%A9%BE%E9%A9%B6/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<link rel=icon href=https://loganchow.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://loganchow.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://loganchow.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://loganchow.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://loganchow.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.2">
<link rel=alternate type=application/rss+xml href=https://loganchow.github.io/categories/%E6%99%BA%E8%83%BD%E9%A9%BE%E9%A9%B6/index.xml>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-138915624-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="智能驾驶">
<meta property="og:description" content="绵绵春雨懒洋洋，故友不来不起床。">
<meta property="og:type" content="website">
<meta property="og:url" content="https://loganchow.github.io/categories/%E6%99%BA%E8%83%BD%E9%A9%BE%E9%A9%B6/"><meta property="og:site_name" content="Mens et Manus">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="智能驾驶">
<meta name=twitter:description content="绵绵春雨懒洋洋，故友不来不起床。">
</head>
<body class=list id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://loganchow.github.io/ accesskey=h title="Logan's Space (Alt + H)">Logan's Space</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://loganchow.github.io/archives title=归档>
<span>归档</span>
</a>
</li>
<li>
<a href=https://loganchow.github.io/categories/ title=分类>
<span>分类</span>
</a>
</li>
<li>
<a href=https://loganchow.github.io/search/ title=搜索>
<span>搜索</span>
</a>
</li>
<li>
<a href=https://loganchow.github.io/tags/ title=标签>
<span>标签</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<header class=page-header><div class=breadcrumbs><a href=https://loganchow.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://loganchow.github.io/categories/>Categories</a></div>
<h1>智能驾驶</h1>
</header>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>ROS学习笔记2
</h2>
</header>
<section class=entry-content>
<p>记录一次在 ROS 学习过程中遇到的问题
message_filter 的使用方法 问题背景 现有一节点需要获取两不同传感器的数据，需要同时订阅两个话题，并将数据整合为一个 JSON 格式的数据帧发送至指定地址的指定端口；要求两帧数据时间戳尽量接近，socket 发送频率不低于 5Hz。
问题剖析 由于数据包不大，且发送频率无上限，故使用 UDP 即可，通过 socket 实现很容易。 JSON 的处理也有第三方库可用。问题关键是：
怎么保证 JSON 包数据的来源话题尽可能时间上接近 什么时候调用 socket 把数据发出去 解决方法一：ros::MultiThreadedSpin() + pthread::rwlock 定义 JSON 数据包为全局变量，分别订阅两个话题，使用两个回调函数，在其中一个回调函数结束写入消息数据时，为全局变量设置读写锁；而另一个回调函数先解锁，再写入消息，再加锁，依次类推。
定义套接字为全局变量，在其中一个回调函数中调用 sendto() 方法发送 JSON 包。
使用ros::MultiThreadedSpin() 来分别调用两话题的回调函数。
解决方法二：message_filter::Subscriber + message_filters::sync_policies::ApproximateTime 使用 message_filter::Subscriber 同时订阅两个话题，使用 ApproximateTime 作为消息订阅的策略，实现两话题的消息时间尽可能接近。
使用 registerCallback 来定义一个总的回调函数来处理两个话题的数据。
实操问题单: boost::bind() 方法的问题 按照教程订阅完话题，设置完消息过滤策略后，设置回调函数时，按照教程写下以下代码：
// 回调函数声明 void ROSHandler::callbackSocket(const glosa::qt_GUIConstPtr& qtSource, const msgs_record::glosaConstPtr& msgSource); ... // 绑定回调函数 sync....</p>
</section>
<footer class=entry-footer>January 3, 2022&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;Me</footer>
<a class=entry-link aria-label="post link to ROS学习笔记2" href=https://loganchow.github.io/posts/ros%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>ROS 学习笔记1
</h2>
</header>
<section class=entry-content>
<p>个人学习过程中的笔记，如有不足敬请指正。
1. ROS 的基本概念 ROS (机器人操作系统) 简单来说就是提供了通讯框架，工具和现成功能的平台，我们最主要用的是通讯功能和工具套件。通讯功能主要包括同步通讯 (Service) 和异步通讯 (Topic)；工具包括 rviz, Gazebo 等。ROS 的分布式框架设计方便智能驾驶和机器人这种多机通讯，数据流分散的场合。
1.1 计算图级 其实就是 ROS 通讯的拓扑网络，是一种点对点的通讯形式。
1. Node 节点，进程，或者说功能单元，是代码模块的最小单位，或者说是最小的单个可执行文件。
ROS 的通讯其实就是节点和节点之间 (不一定直接)的通信。
一个节点既可以实现订阅，也可以实现发布，也能同时实现。
2. Master 主人？ 节点管理器，所有的节点都要找它进行注册才能被其他节点发现。因此要先启动节点管理器 (roscore)再启动节点 (rosrun)。
3. Message 消息，节点之间通讯的内容或媒介，可以自定义格式，就和 C 语言里的结构体一样，只不过 Message 更像是具体的对象，抽象的 *.msg 定义在对应 Topic 的文件夹中，或是单独作为一个程序包并被其他程序包所包括。
4. Topic 话题，或者叫主题，可以看成是一个频道，或者说是一个广场，单个或多个节点可以向一个话题发送消息，单个或多个节点也可以去订阅这个话题来获取消息。因此，话题的存在实现了消息发布者和消息订阅者之间的解耦，两者无需直接通信，无需知道对方的存在。
一个话题对应一种格式类型的 Message。
Topic 的内容在代码层面是字符串。
5. Service 服务，相对于话题的通讯模式是像 UDP 的广播式，它更像是TCP，是一端到另一端的直接通讯，并针对一次请求给予一次回应。因此没有频繁的消息传递，也就没有高系统资源占用。
Service通信是一对一通信，信息流是双向的，而且客户端与服务端之间的执行是同步的 (有一定顺序的)。
6. Bag 包 (为了区别下文中的程序包package一般口头叫它rosbag)，用于保存并回放 ROS 运行中所有消息数据的特殊格式，在 debug 和数据后处理阶段非常有用。
回放 bag 时，Master 会创建一个临时节点来发送 bag 中记录的数据，其他所有话题直接订阅这个临时节点，消息是不经过我们自定义的节点的。因此，使用 bag 录制的数据来验证后修改的代码是不可行的。...</p>
</section>
<footer class=entry-footer>June 18, 2020&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;Me</footer>
<a class=entry-link aria-label="post link to ROS 学习笔记1" href=https://loganchow.github.io/posts/ros%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/></a>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://loganchow.github.io/>Mens et Manus</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>